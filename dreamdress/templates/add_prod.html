<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Dress</title>
    <link href="/static/img/favicon.png" rel="icon">
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* Custom styles */
        body {
            background-color: #fbfafa; /* White background */
            color: #0b0b0b; /* Dark text */
            font-family: 'Arial', sans-serif; /* Font style */
        }

        header {
            background-color: #ff69b4; /* Pink header */
            color: #fff; /* White text */
            padding: 10px;
            margin-bottom: 20px;
        }

        header img {
            max-height: 50px;
        }

        header h4 {
            font-size: 1.2em;
            margin-bottom: 0;
        }

        .error {
            color: red; /* Red color for errors */
            font-size: 0.9em;
        }

        input[type="file"] {
            border: none;
            background-color: #f8f9fa;
            color: #495057;
        }

        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding: 12px;
            background: #f8f9fa url('https://cdn3.iconfinder.com/data/icons/iconic-1/32/sync_32x32.png') no-repeat right center / 18px;
        }
        
        input[type="submit"] {
            background-color: #0056b3;
            color: #ffffff;
            padding: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            font-weight: bold;
            margin-top: 20px;
        }
         
        input[type="submit"]:hover {
            background-color: #0ade34; /* Green color on hover */
        }

        .card-header {
            background-color: #b9bfc6;
        }

        .card-body {
            padding: 20px;
        }

        .form-row {
            margin-bottom: 20px;
        }

        .btn-primary {
            margin-top: 10px;
        }
        .cancel-sign {
            font-weight: bold;
            color: red;
        }
        .invalid-feedback {
        display: none;
        color: red;
    }
        .is-invalid {
            border: 1px solid red;
        }

    </style>
    <title>Add Dress</title>
</head>
<body>

<!-- Header -->
<header class="bg-dark">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-4">
                <img src="/static/img/favicon.png" alt="DreamDress Logo" class="img-fluid" style="max-height: 50px;">
				<span style="color: crimson;">DreamDress</span>
                <span></span>
                <span style="color: crimson;"><a href="{% url 'seller_dashboard' %}">Dashboard</a></span>
            </div>
            <div class="col-md-4">
                <h4 style="color:crimson;">Welcome  <span id="username">{{ user.username }}</span></h4>
            </div>
            
            <div class="col-md-4 text-right">
                <a href="{% url 'logout' %}" class="btn btn-danger">Logout</a>
            </div>
        </div>
    </div>
</header>

<!-- Main Content - Add Dress Form -->
<div class="container">
    <div class="card">
        <div class="card-header">
            <h5>Add Dress Product</h5>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" onsubmit="return validateForm()">
                {% csrf_token %}
                
                <!-- Brand Name and Category -->
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="brandName">Brand Name</label>
                        <input type="text" class="form-control" name="brand_name" id="brand_name" required oninput="validateBrandName()" placeholder="Enter brand name">
                        <div id="brand_name_error" class="error"></div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="categories">Category</label>
                        <div class="input-group">
                            <select class="form-control category-dropdown" name="category_id">
                                <option value="" selected disabled>Select category</option>
                                {% for category in categories %}
                                    <option value="{{ category.category_id }}">{{ category.category_name }}</option>
                                {% endfor %}
                            </select>
                            <div class="input-group-append">
                                <button type="button" class="btn btn-outline-primary add-category-button">+</button>
                            </div>
                        </div>
                        <div class="input-group mt-3" style="display: none;" id="new-category">
                            <input type="text" class="form-control" id="new-category-name" placeholder="Enter new category" style="width: 100%;">
                            <div class="input-group-append">
                                <button type="button" class="btn btn-primary check-category-button">Check</button>
                            </div>
                        </div>
                    </div>
                                
                </div>

                <!-- Description and Material -->
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="description">Description</label>
                        <textarea class="form-control" name="about_product" id="about_product" required oninput="validateAboutProduct()" rows="3" placeholder="Enter product description"></textarea>
                        <div id="about_product_error" class="error"></div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="material">Material</label>
                        <input type="text" class="form-control" name="material" required oninput="validateField('material')" placeholder="Enter material">
                        <div id="material_error" class="error"></div>
                    </div>
                </div>

                <!-- Price -->
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="price">Price</label>
                        <input type="text" class="form-control" name="current_price" id="current_price" step="0.01" required oninput="validateCurrentPrice()" placeholder="Enter price">
                        <div id="current_price_error" class="error"></div>
                    </div>
                </div>

                <!-- Dynamic stock management section -->
                <div id="dynamic-stock-section">
                    <!-- This is where dynamically added rows will go -->
                </div>

                <!-- Button to add a new row for managing stock -->
                <button type="button" class="btn btn-primary" onclick="addStockRow()">Manage Stock</button>

                <!-- Submit button for adding the product -->
                <button type="submit" class="btn btn-primary" name="addproduct">Add Product</button>
                       
        </div>
    </div>
</div>


<!-- Bootstrap JS and jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


<!-- <manage stock -->
    <script>
        function addStockRow() {
            // Create a new row for managing stock
            var stockRow = `
                <div class="stock-row">
                    <div class="color-fields">
                        <div class="form-group col-md-6">
                            <label for="colors">Color</label>
                            <div class="input-group">
                                <select class="form-control color-dropdown" name="colour_id">
                                    <option value="" selected disabled>Select color</option>
                                    {% for color in colors %}
                                        <option value="{{ color.colour_id }}">{{ color.colour_name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="input-group-append">
                                    <button type="button" class="btn btn-outline-primary add-color-button">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="productImage">Product Image</label>
                        <input type="file" class="form-control-file product-image" name="product_images[]" required>
                    </div>
                    <div class="sizes-section">
                        <!-- This is where dynamically added size rows will go -->
                    </div>
                    <button type="button" class="btn btn-primary add-size-button">Add Size</button>
                    <button type="button" class="btn btn-primary done-button">Done</button>
                    <span class="cancel-sign">X</span> <!-- Cancel sign -->
                </div>
            `;
        
            // Append the new row to the dynamic-stock-section
            document.getElementById('dynamic-stock-section').insertAdjacentHTML('beforeend', stockRow);
        
            // Attach event listener to the "Add Size" button
            var addSizeButton = document.querySelector('.stock-row:last-child .add-size-button');
            addSizeButton.addEventListener('click', function() {
                addSizeRow(this); // Add a new size row when "Add Size" button is clicked
            });
        
            // Attach event listener to the "Done" button
            var doneButton = document.querySelector('.stock-row:last-child .done-button');
            doneButton.addEventListener('click', function() {
                addStockRow(); // Add a new row when "Done" button is clicked
            });
            
            // Attach event listener to the cancel sign
            var cancelSign = document.querySelector('.stock-row:last-child .cancel-sign');
            cancelSign.addEventListener('click', function() {
                this.parentElement.remove(); // Remove the current stock row
            });
        }
        
        function addSizeRow(button) {
            var sizeRow = `
                <div class="size-row">
                    <div class="form-group col-md-6">
                        <label for="sizes">Size</label>
                        <select class="form-control sizes" name="size_id">
                            <option selected disabled>Select size</option>
                            {% for size in sizes %}
                                <option value="{{ size.size_id }}">{{ size.size_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="stockQuantity">Stock Quantity</label>
                        <input type="number" class="form-control text-center stock-quantity" value="1" name="stock_quantity[]" id="stockQuantity" required>
                        <span class="error-message" style="color: red; display: none;">Stock quantity cannot be negative.</span>
                    </div>
                </div>
            `;
        
            // Insert the new size row before the button
            button.insertAdjacentHTML('beforebegin', sizeRow);
        }
        </script>
        
</form>


<!-- stock quantity validation -->
<script>
    document.getElementById("stockQuantity").addEventListener("input", function() {
        var inputValue = this.value;
        console.log("Input value:", inputValue); // Log the input value to the console
        
        var errorMessage = document.querySelector('.error-message');
        
        if (inputValue < 0) {
            errorMessage.style.display = "inline";
            this.setCustomValidity("Stock quantity cannot be negative.");
        } else {
            errorMessage.style.display = "none";
            this.setCustomValidity("");
        }
    });
</script>


<!-- add category    -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const addCategoryButton = document.querySelector('.add-category-button');
        const newCategoryDiv = document.getElementById('new-category');
        const checkCategoryButton = document.querySelector('.check-category-button');

        addCategoryButton.addEventListener('click', function() {
            newCategoryDiv.style.display = 'block';
        });

        checkCategoryButton.addEventListener('click', function() {
            const newCategoryName = document.getElementById('new-category-name').value;
            // Send AJAX request to check if category exists
            fetch(`/check_category/?category_name=${newCategoryName}`)
            .then(response => response.json())
            .then(data => {
                if (data.exists) {
                    alert('Category already exists!');
                } else {
                    // Send AJAX request to add new category
                    fetch(`/add_category/?category_name=${newCategoryName}`)
                    .then(response => response.json())
                    .then(data => {
                        alert('Category added successfully!');
                        // Update dropdown with new category
                        const categoryDropdown = document.querySelector('.category-dropdown');
                        const option = document.createElement('option');
                        option.value = data.category_id;
                        option.textContent = newCategoryName;
                        categoryDropdown.appendChild(option);
                    })
                    .catch(error => {
                        console.error('Error adding category:', error);
                    });
                }
            })
            .catch(error => {
                console.error('Error checking category:', error);
            });
        });
    });
</script>
 
    
    


<script>
    function addImageField() {
        var container = document.getElementById('image-container');
        var numImages = container.getElementsByTagName('input').length + 1;

        var input = document.createElement('input');
        input.type = 'file';
        input.name = 'image_' + numImages;
        container.appendChild(input);

        document.getElementById('num_images').value = numImages;
    }

    // Add validation function for the main image
    function validateMainImage() {
        var mainImageInput = document.querySelector('input[name="main_image"]');
        var mainImageError = document.getElementById('main_image_error');

        if (!mainImageInput.files.length) {
            mainImageError.textContent = 'Main Image is required';
        } else {
            mainImageError.textContent = '';
        }
    }

    // Add event listener for input change
    document.querySelector('input[name="main_image"]').addEventListener('change', validateMainImage);
</script>

<!--Dynamic adding of colours-->
<script>
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    var csrftoken = getCookie('csrftoken');

    // Function to add a new color field
    function addColorField() {
        var newColorField = `
            <div class="input-group mt-2">
                <input type="text" class="form-control new-color-input" placeholder="Enter new color">
                <div class="input-group-append">
                    <button type="button" class="btn btn-outline-primary check-color-button">Check</button>
                    <button type="button" class="btn btn-outline-danger remove-color-button">-</button>
                </div>
            </div>
        `;
        $('.color-fields').append(newColorField);
    }

    // Event listener for the plus button to add a new color field
    $(document).on('click', '.add-color-button', function() {
        addColorField();
    });

    // Event listener for the minus button to remove a color field
    $(document).on('click', '.remove-color-button', function() {
        $(this).closest('.input-group').remove();
    });

    // Event listener for the check color button
    $(document).on('click', '.check-color-button', function() {
        var colorInput = $(this).closest('.input-group').find('.new-color-input');
        var color = colorInput.val().trim(); // Get the entered color

        // Check if the color is empty
        if (color === '') {
            alert('Please enter a color.');
            return;
        }

        // Send an AJAX request to check if the color exists in the database
        $.ajax({
            url: '/check_color/',
            method: 'POST',
            headers: { "X-CSRFToken": csrftoken }, // Add CSRF token to headers
            data: {
                'color_name': color
            },
            success: function(response) {
                if (response.exists) {
                    alert('This color already exists.');
                } else {
                    // If the color doesn't exist, add it to the database
                    $.ajax({
                        url: '/add_color/',
                        method: 'POST',
                        headers: { "X-CSRFToken": csrftoken }, // Add CSRF token to headers
                        data: {
                            'color_name': color
                        },
                        success: function(response) {
                            if (response.success) {
                                alert('Color added successfully.');
                            } else {
                                alert('Failed to add color.');
                            }
                        },
                        error: function(xhr, status, error) {
                            alert('An error occurred while adding the color.');
                        }
                    });
                }
            },
            error: function(xhr, status, error) {
                alert('An error occurred while checking the color.');
            }
        });
    });
</script>

<!-- categor dynamically -->
<script>
    // // Function to add a new category field
    // function addCategoryField() {
    //     var newCategoryField = `
    //         <div class="input-group mt-2">
    //             <input type="text" class="form-control new-category-input" placeholder="Enter new category">
    //             <div class="input-group-append">
    //                 <button type="button" class="btn btn-outline-primary check-category-button">Check</button>
    //                 <button type="button" class="btn btn-outline-danger remove-category-button">-</button>
    //             </div>
    //         </div>
    //     `;
    //     $('.category-fields').append(newCategoryField);
    // }

    // // Event listener for the plus button to add a new category field
    // $(document).on('click', '.add-category-button', function() {
    //     addCategoryField();
    // });

    // // Event listener for the minus button to remove a category field
    // $(document).on('click', '.remove-category-button', function() {
    //     $(this).closest('.input-group').remove();
    // });

    // // Event listener for the check category button
    // $(document).on('click', '.check-category-button', function() {
    //     var categoryInput = $(this).closest('.input-group').find('.new-category-input');
    //     var category = categoryInput.val().trim(); // Get the entered category

    //     // Check if the category is empty
    //     if (category === '') {
    //         alert('Please enter a category.');
    //         return;
    //     }

    //     // Send an AJAX request to check if the category exists in the database
    //     $.ajax({
    //         url: '/check_category/',
    //         method: 'POST',
    //         headers: { "X-CSRFToken": csrftoken }, // Add CSRF token to headers
    //         data: {
    //             'category_name': category
    //         },
    //         success: function(response) {
    //             if (response.exists) {
    //                 alert('This category already exists.');
    //             } else {
    //                 // If the category doesn't exist, add it to the database
    //                 $.ajax({
    //                     url: '/add_category/',
    //                     method: 'POST',
    //                     headers: { "X-CSRFToken": csrftoken }, // Add CSRF token to headers
    //                     data: {
    //                         'category_name': category
    //                     },
    //                     success: function(response) {
    //                         if (response.success) {
    //                             alert('Category added successfully.');
    //                         } else {
    //                             alert('Failed to add category.');
    //                         }
    //                     },
    //                     error: function(xhr, status, error) {
    //                         alert('An error occurred while adding the category.');
    //                     }
    //                 });
    //             }
    //         },
    //         error: function(xhr, status, error) {
    //             alert('An error occurred while checking the category.');
    //         }
    //     });
    // });
</script>


<!-- field validation -->
<script>
    function validateField(fieldName, errorId) {
            var inputField = document.getElementsByName(fieldName)[0];
            var errorElement = document.getElementById(errorId);

            // Regular expression to allow only letters (both uppercase and lowercase)
            var lettersOnly = /^[A-Za-z]+$/;

            if (inputField.value.trim() === '') {
                errorElement.textContent = fieldName.charAt(0).toUpperCase() + fieldName.slice(1) + ' is required';
            } else if (!lettersOnly.test(inputField.value)) {
                errorElement.textContent = 'Only letters are allowed in the ' + fieldName.charAt(0).toUpperCase() + fieldName.slice(1);
            } else {
                errorElement.textContent = '';
            }
        }
    function validateProductName() {
            var productNameInput = document.getElementById('product_name');
            var productNameError = document.getElementById('product_name_error');

            var lettersOnly = /^[A-Za-z]+$/;

            if (productNameInput.value.trim() === '') {
                productNameError.textContent = 'Product Name is required';
            } else if (!lettersOnly.test(productNameInput.value)) {
                productNameError.textContent = 'Only letters are allowed in the Product Name';
            } else {
                productNameError.textContent = '';
            }
        }

    function validateAboutProduct() {
        var aboutProductInput = document.getElementById('about_product');
        var aboutProductError = document.getElementById('about_product_error');

        var lettersAndSpacesOnly = /^[A-Za-z ]+$/;

        if (aboutProductInput.value.trim() === '') {
            aboutProductError.textContent = 'About Product is required';
        } else if (!lettersAndSpacesOnly.test(aboutProductInput.value)) {
            aboutProductError.textContent = 'Only letters and spaces are allowed in the About Product';
        } else {
            aboutProductError.textContent = '';
        }
}
function validateCurrentPrice() {
            var currentPriceInput = document.getElementById('current_price');
            var currentPriceError = document.getElementById('current_price_error');

            var digitsOnly = /^\d+$/;

            if (currentPriceInput.value.trim() === '') {
                currentPriceError.textContent = 'Current Price is required';
            } else if (!digitsOnly.test(currentPriceInput.value)) {
                currentPriceError.textContent = 'Only digits are allowed in the Current Price';
            } else {
                currentPriceError.textContent = '';
            }
        }

        function validateField(fieldName) {
        var input = document.getElementsByName(fieldName)[0];
        var errorElement = document.getElementById(fieldName + '_error');

        // Regular expression to allow only letters (both uppercase and lowercase)
        var lettersOnly = /^[A-Za-z]+$/;

        if (input.value.trim() === '') {
            errorElement.textContent = 'Color is required';
        } else if (!lettersOnly.test(input.value)) {
            errorElement.textContent = 'Only letters are allowed in the Color';
        } else {
            errorElement.textContent = '';
        }
    }
    function validateField(fieldName) {
        var inputField = document.getElementsByName(fieldName)[0];
        var errorElement = document.getElementById(fieldName + '_error');

        // Regular expression to allow only letters (both uppercase and lowercase)
        var lettersOnly = /^[A-Za-z]+$/;

        if (inputField.value.trim() === '') {
            errorElement.textContent = 'Material is required';
        } else if (!lettersOnly.test(inputField.value)) {
            errorElement.textContent = 'Only letters are allowed in the Material';
        } else {
            errorElement.textContent = '';
        }
    }
    function validateForm() {
            // Add overall form validation logic here
            // Return true if the form is valid, false otherwise

            var errorElements = document.querySelectorAll('.error');
            for (var i = 0; i < errorElements.length; i++) {
                if (errorElements[i].textContent !== '') {
                    return false;
                }
            }

            return true;
        }
        function addImageField() {
            var container = document.getElementById('image-container');
            var numImages = container.getElementsByTagName('input').length + 1;

            var input = document.createElement('input');
            input.type = 'file';
            input.name = 'image_' + numImages;
            container.appendChild(input);

            document.getElementById('num_images').value = numImages;
        }

</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#sizes').select2();
    });
</script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

</body>
</html>
