<!-- extra.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.product_name }}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <style>
        .carousel-item img {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-6">
                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        {% for index, image in product_images_with_index %}
                            <li data-target="#carouselExampleIndicators" data-slide-to="{{ index }}" {% if forloop.first %}class="active"{% endif %}></li>
                        {% endfor %}
                    </ol>
                    <div class="carousel-inner">
                        {% for index, image in product_images_with_index %}
                            <div class="carousel-item {% if index == 0 %}active{% endif %}">
                                <img src="{{ image.image.url }}" class="d-block w-100" style="object-fit: cover;" alt="Product Image">
                            </div>
                        {% endfor %}
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
            <div class="col-md-6">
                <h2>{{ product.product_name }}</h2>
                <p>Description: {{ product.product_about_product }}</p>
                <p>Price: â‚¹{{ product.product_current_price }}</p>
                <p>Category: {{ product.category.category_name }}</p>
                <form action="{% url 'add_to_cart' product_id=product.product_id %}" method="post" id="add-to-cart-form"></form>
                    {% csrf_token %}
                    <p>Select Size:</p>
                    {% for size in sizes %}
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="size" id="size_{{ forloop.counter }}" value="{{ size.size_name }}">
                            <label class="form-check-label" for="size_{{ forloop.counter }}">{{ size.size_name }}</label>
                        </div>
                    {% endfor %}
                    <p>Select Color:</p>
                    {% for color in colors %}
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="color" id="color_{{ forloop.counter }}" value="{{ color.colour_name }}">
                            <label class="form-check-label" for="color_{{ forloop.counter }}">{{ color.colour_name }}</label>
                        </div>
                    {% endfor %}
                    <p>Quantity:</p>
                    <input type="number" class="form-control" name="quantity" min="1" required>
                    <div class="invalid-feedback">Please enter a valid quantity.</div>
                    <input type="submit" value="Add to Cart">
                    <div id="error-message" class="text-danger mt-2" style="display: none;">Stock is finished.</div>
                </form>
                
            </div>
        </div>
    </div>

<!-- managing quantity -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#add-to-cart-form').submit(function(event) {
                event.preventDefault();
                var form = $(this);
                $.ajax({
                    type: form.attr('method'),
                    url: form.attr('action'),
                    data: form.serialize(),
                    success: function(data) {
                        if ('error' in data) {
                            $('#error-message').show().text(data.error);
                        } else {
                            $('#error-message').hide();
                            // Handle successful addition to cart
                        }
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        $('#error-message').show().text('Error: ' + textStatus);
                    }
                });
            });
        });
    </script>
    
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
