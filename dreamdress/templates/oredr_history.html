<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DreamDress-Order</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <!-- Favicon -->
  <link href="/static/img/favicon.png" rel="icon">

  <style>
    body {
      background-color: #ffffff; /* White background */
    }

    /* Navbar adjustments */
    .navbar {
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      background-color: #ffffff; /* White navbar background */
    }

    .navbar-brand {
      font-weight: bold;
      color: #a55850; /* Baby pink text color */
    }

    .navbar-nav .nav-link {
      margin-right: 10px;
      color: #a55850; /* Baby pink text color */
    }

    /* Sidebar adjustments */
    .list-group-item {
      border-radius: 0;
      color: #a55850; /* Baby pink text color */
      background-color: #ffffff; /* White sidebar background */
    }

    .list-group-item:hover {
      background-color: #a55850; /* Light pink hover background */
    }

    /* Optional styles for content area */
    .container {
      margin-top: 20px;
      color: #333333; /* Dark text color */
    }

    /* Table adjustments */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #cebfbf; /* Light gray border bottom */
      text-align: left;
    }

    th {
      background-color: #f2f2f2; /* Light gray background for header */
      color: #333333; /* Dark text color */
    }

    /* Image adjustments */
    .product-image {
      max-width: 100px; /* Adjust image max-width as needed */
      height: auto;
    }
    .rating .star.selected {
    color: gold; /* Change the color of selected stars */
}
/* Change the background color of the button */
.btn-primary {
    background-color: #D19C97; /* Change to the desired color */
}

/* Change the text color of the button */
.btn-primary {
    color: #151414; /* Change to the desired text color */
}

/* Optional: Change the color when hovering over the button */
.btn-primary:hover {
    background-color: #f0847a; /* Change to the desired color */
}

  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">DreamDress</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'home' %}">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'customer_dashboard' %}">Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'logout' %}">Logout</a>
          </li>
        </ul>
      </div>
      <span class="input-group-text bg-transparent text-primary"><i class="fa fa-user">Hello, {{ user.username }}</i>  </span>
    </div>
  </nav>

  <div class="container mt-4">
    <h1>Order History</h1>
    <table class="table" style="width: 100%; border-collapse: collapse;">
      <thead style="background-color: #9da4ac;">
        <tr>
          <th style="padding: 8px;">Brand</th>
          <th style="padding: 8px;">Category</th>
          <th style="padding: 8px;">Price</th>
          <th style="padding: 8px;">Quantity</th>
          <th style="padding: 8px;">Image</th>
          <th style="padding: 8px;">Download Reciept</th>
          <th style="padding: 8px;">Reviews</th>
          <th style="padding: 8px;">Ratings</th>
        </tr>
      </thead>
      <tbody>
        {% for order, order_item_data in order_data %}
          {% for order_item in order_item_data %}
            <tr>
              <td style="padding: 8px;">{{ order_item.brand_name }}</td>
              <td style="padding: 8px;">{{ order_item.category_name }}</td>
              <td style="padding: 8px;">{{ order_item.price }}</td>
              <td style="padding: 8px;">{{ order_item.quantity }}</td>
              <td style="padding: 8px;">
                {% if order_item.image_url %}
                  <img src="{{ order_item.image_url }}" alt="Product Image" class="product-image" style="max-width: 100px; height: auto;">
                {% else %}
                  No image available
                {% endif %}
                <td><a href="{% url 'generate_pdf_bill' %}">Download Receipt</a></td>
               
                <form method="post" action="{% url 'submit_review' %}" id="review-form">
                  {% csrf_token %}
                  <input type="hidden" name="product_id" value="{{ order_item.product_id }}">
                  <td>
                    <div style="position: relative;">
                        <textarea class="form-control" name="text" rows="3" placeholder="Write your review here" {% if order_item.existing_review %}readonly{% endif %}>{% if order_item.existing_review %}{{ order_item.existing_review.text }}{% endif %}</textarea>
                        <button type="button" class="btn btn-outline-secondary edit-icon" style="position: absolute; top: 5px; right: 5px;" onclick="toggleEdit()"> 
                            <i class="fa fa-pencil-alt"></i> <!-- Edit icon -->
                        </button>
                        <!-- Display existing review if it exists -->
                          <!-- {% if order_item.existing_review %}
                          <div class="mt-2">
                              <strong>Your existing review:</strong>
                              <p>{{ order_item.existing_review.text }}</p>
                              <p>Rating: {{ order_item.existing_review.rating }}</p>
                          </div>
                          {% endif %} 
                    </div>-->
                  </td>
                  <script>
                    function toggleEdit() {
                        var textarea = document.querySelector('textarea[name="text"]');
                        var editButton = document.querySelector('.edit-icon');
                
                        // Toggle the readonly attribute of the textarea
                        textarea.readOnly = !textarea.readOnly;
                
                        // Change the button icon based on readonly state
                        if (textarea.readOnly) {
                            editButton.innerHTML = '<i class="fa fa-pencil-alt"></i>';
                        } else {
                            editButton.innerHTML = '<i class="fa fa-check"></i>'; // Change icon to a check mark or any appropriate icon
                            textarea.focus(); // Focus on the textarea for editing
                        }
                    }
                </script>
                  <td>
                    <div class="rating">
                        <span class="star" data-rating="1">&#9733;</span>
                        <span class="star" data-rating="2">&#9733;</span>
                        <span class="star" data-rating="3">&#9733;</span>
                        <span class="star" data-rating="4">&#9733;</span>
                        <span class="star" data-rating="5">&#9733;</span>
                    </div>
                    <input type="hidden" class="rating-value" name="rating" value="0"> <!-- Hidden input field to store the selected rating -->
                </td>
                
                  <td>
                    <button type="submit" class="btn btn-primary submit-review">Submit</button>
                    
                  </td>
                </form>
                
            
          
            
            </tr>
          {% endfor %}
        {% endfor %}
      </tbody>
    </table>
    <!-- Success message for review submission -->
    <div id="success-message" class="alert alert-success mt-3" style="display: none;">
      Review submitted successfully
  </div>
    
</div>

<!-- ratings -->
<script>
  // Add event listener to stars
  document.querySelectorAll('.star').forEach(function(star) {
      star.addEventListener('click', function() {
          // Get the selected rating from data-rating attribute
          var rating = this.getAttribute('data-rating');

          // Update the value of the hidden input field
          document.querySelector('.rating-value').value = rating;

          // Highlight the selected star and unhighlight the others
          document.querySelectorAll('.star').forEach(function(s) {
              if (s.getAttribute('data-rating') <= rating) {
                  s.classList.add('active');
              } else {
                  s.classList.remove('active');
              }
          });
      });
  });
</script>

<script>
  // Get all star elements
  const stars = document.querySelectorAll('.rating .star');

  // Add click event listener to each star
  stars.forEach(star => {
      star.addEventListener('click', function() {
          // Get the selected rating from the data-rating attribute
          const rating = this.getAttribute('data-rating');

          // Highlight all stars up to the selected rating
          stars.forEach(s => {
              if (s.getAttribute('data-rating') <= rating) {
                  s.classList.add('selected');
              } else {
                  s.classList.remove('selected');
              }
          });

          // You can store the selected rating in a hidden input field or send it to the server via AJAX
          // Example: document.getElementById('ratingInput').value = rating;
      });
  });
</script> 

<!-- rating and review submission -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $('#review-form').submit(function(e) {
        e.preventDefault(); // Prevent the default form submission
        
        // Submit the form via AJAX
        $.ajax({
            type: 'POST',
            url: $(this).attr('action'),
            data: $(this).serialize(),
            success: function(response) {
                if (response.success) {
                    // Show the success message after 2 seconds
                    $('#success-message').fadeIn().delay(2000).fadeOut();
                } else {
                    alert('Failed to add review. Please try again.');
                }
            },
            error: function() {
                alert('An error occurred while processing your request.');
            }
        });
    });
});

</script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
